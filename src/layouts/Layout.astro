---
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { getLangFromUrl, useTranslations } from '../i18n/utils';
import { languages } from '../i18n/ui';
import AdsInFeed from '../components/AdsInFeed.astro';
import { ClientRouter } from 'astro:transitions';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

interface Props {
  title: string;
  description?: string;
}
const { title, description } = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, 'https://get-password.com');
const currentPath = Astro.url.pathname;
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset='UTF-8' />
    <meta name='description' content={description || t('meta.content')} />
    <meta name='viewport' content='width=device-width' />
    <link rel='icon' type='image/svg+xml' href='/favicon.svg' />
    <meta name='generator' content={Astro.generator} />
    <title>{title} | Get-password</title>

    <!-- Canonical & hreflang -->
    <link rel='canonical' href={canonicalURL.href} />
    {Object.keys(languages).map((locale) => {
      const localePath = currentPath.replace(/^\/(en|fr|es|de)(\/|$)/, `/${locale}/`);
      const href = new URL(localePath || `/${locale}/`, 'https://get-password.com').href;
      return <link rel='alternate' hreflang={locale} href={href} />;
    })}
    <link rel='alternate' hreflang='x-default' href='https://get-password.com/en/' />

    <!-- Open Graph -->
    <meta property='og:type' content='website' />
    <meta property='og:title' content={title} />
    <meta property='og:description' content={description || t('meta.content')} />
    <meta property='og:url' content={canonicalURL.href} />
    <meta property='og:site_name' content='Get-password' />
    <meta property='og:locale' content={lang} />

    <!-- Twitter Card -->
    <meta name='twitter:card' content='summary' />
    <meta name='twitter:title' content={title} />
    <meta name='twitter:description' content={description || t('meta.content')} />

    <!-- Preconnect for external resources -->
    <link rel='preconnect' href='https://pagead2.googlesyndication.com' crossorigin />
    <link rel='dns-prefetch' href='https://pagead2.googlesyndication.com' />

    <!-- Font preload -->
    <link rel='preload' href='/fonts/VarelaRound-Regular.ttf' as='font' type='font/ttf' crossorigin />

    <ClientRouter />
  </head>
  <body>
    <Header />
    <slot />

    <div class="ads-google">
      <script is:inline async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3402470307945870"
      crossorigin="anonymous"></script>
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-format="fluid"
          data-ad-layout-key="-f7+5u+4t-da+6l"
          data-ad-client="ca-pub-3402470307945870"
          data-ad-slot="3718160833"></ins>
      <script is:inline>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>

    <Footer />

    <!-- Back to top button -->
    <button class="back-to-top" id="backToTop" aria-label="Back to top" type="button">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="18 15 12 9 6 15"></polyline>
      </svg>
    </button>
  </body><!-- Combined Dark Mode Management Script -->
  <script is:inline>
    (function () {
      // Retrieve the saved theme from localStorage or fallback to the system preference
      const savedTheme = localStorage.getItem('theme');
      const prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');

      /**
       * Applies the given theme by toggling the "dark-mode" class on the document element.
       * Also updates the localStorage and the state of the toggle button icons (if available).
       * @param {string} theme - Either 'dark' or 'light'
       */
      function applyTheme(theme) {
        const isDark = theme === 'dark';
        document.documentElement.classList.toggle('dark-mode', isDark);
        localStorage.setItem('theme', theme);

        // Update toggle button icons if the element exists
        const toggleButton = document.querySelector('.dark-mode-toggle');
        if (toggleButton) {
          const moonIcon = toggleButton.querySelector('.moon-icon');
          const sunIcon = toggleButton.querySelector('.sun-icon');
          if (moonIcon && sunIcon) {
            moonIcon.style.display = isDark ? 'none' : 'inline';
            sunIcon.style.display = isDark ? 'inline' : 'none';
          }
        }
      }

      // Initialize the theme on page load
      applyTheme(savedTheme || (prefersDarkMode.matches ? 'dark' : 'light'));

      // Listen for changes in the system's dark mode preference
      prefersDarkMode.addEventListener('change', e => {
        applyTheme(e.matches ? 'dark' : 'light');
      });

      // Expose a global function to toggle the theme
      window.toggleTheme = () => {
        const currentTheme = document.documentElement.classList.contains(
          'dark-mode'
        )
          ? 'dark'
          : 'light';
        applyTheme(currentTheme === 'dark' ? 'light' : 'dark');
      };

      // Once the DOM is fully loaded, attach a click listener to the toggle button (if present)
      document.addEventListener('DOMContentLoaded', () => {
        const toggleButton = document.querySelector('.dark-mode-toggle');
        if (toggleButton) {
          toggleButton.addEventListener('click', () => {
            const currentTheme = document.documentElement.classList.contains(
              'dark-mode'
            )
              ? 'dark'
              : 'light';
            applyTheme(currentTheme === 'dark' ? 'light' : 'dark');
          });
        }
      });
    })();
  </script>

  <script is:inline>
    (function () {
      function initBackToTop() {
        const btn = document.getElementById('backToTop');
        if (!btn || btn.dataset.initialized) return;
        btn.dataset.initialized = 'true';

        window.addEventListener('scroll', () => {
          btn.classList.toggle('visible', window.scrollY > 400);
        }, { passive: true });

        btn.addEventListener('click', () => {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initBackToTop);
      } else {
        initBackToTop();
      }
      document.addEventListener('astro:page-load', initBackToTop);
    })();
  </script>

  <style>
    .back-to-top {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: var(--color-bg-primary);
      color: var(--color-text-primary);
      box-shadow: var(--shadow-soft);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: none;
      padding: 0;
      opacity: 0;
      visibility: hidden;
      transform: translateY(20px);
      transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
      z-index: 999;
    }

    .back-to-top.visible {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .back-to-top:hover {
      box-shadow: var(--shadow-hover);
      transform: translateY(-2px);
    }

    .back-to-top:active {
      box-shadow: var(--shadow-inset);
    }

    @media (max-width: 768px) {
      .back-to-top {
        bottom: 20px;
        right: 20px;
        width: 40px;
        height: 40px;
      }
    }
  </style>

  <style>
    .ads-google{
        background: none;
        z-index: 2000;
        width: 100%;
        max-width: 1024px;
        margin: 0 auto;
        justify-content: center;
        min-height: 100px;
    }
  </style>

  <style is:global>
    :root {
      --color-bg-primary: #e0e5ec;
      --color-bg-secondary: #e0e5ec;
      --color-text-primary: #2d3436;
      --color-text-secondary: #636e72;
      --color-accent: #4a7cc9;
      --color-accent-hover: #3a6ab5;
      --color-border-color: transparent;
      --color-bg-navbar: #e0e5ec;

      /* Neumorphic shadows */
      --shadow-light: -6px -6px 14px rgba(255, 255, 255, 0.7);
      --shadow-dark: 6px 6px 14px rgba(163, 177, 198, 0.6);
      --shadow-soft: var(--shadow-light), var(--shadow-dark);
      --shadow-hover: -8px -8px 16px rgba(255, 255, 255, 0.8), 8px 8px 16px rgba(163, 177, 198, 0.7);
      --shadow-inset: inset 4px 4px 8px rgba(163, 177, 198, 0.5), inset -4px -4px 8px rgba(255, 255, 255, 0.7);
      --shadow-inset-active: inset 6px 6px 12px rgba(163, 177, 198, 0.6), inset -6px -6px 12px rgba(255, 255, 255, 0.8);

      font-size: 16px;
    }

    /* Reduce font size on smaller screens */
    @media (max-width: 768px) {
      :root {
        font-size: 15px;
      }
    }

    :root.dark-mode {
      --color-bg-primary: #2d2d3d;
      --color-bg-secondary: #2d2d3d;
      --color-text-primary: #e0e0e0;
      --color-text-secondary: #a0a0b0;
      --color-accent: #5a8fd4;
      --color-accent-hover: #4a7cc9;
      --color-bg-navbar: #2d2d3d;

      --shadow-light: -6px -6px 14px rgba(60, 60, 80, 0.5);
      --shadow-dark: 6px 6px 14px rgba(15, 15, 25, 0.5);
      --shadow-soft: var(--shadow-light), var(--shadow-dark);
      --shadow-hover: -8px -8px 16px rgba(60, 60, 80, 0.6), 8px 8px 16px rgba(15, 15, 25, 0.6);
      --shadow-inset: inset 4px 4px 8px rgba(15, 15, 25, 0.4), inset -4px -4px 8px rgba(60, 60, 80, 0.4);
      --shadow-inset-active: inset 6px 6px 12px rgba(15, 15, 25, 0.5), inset -6px -6px 12px rgba(60, 60, 80, 0.5);
    }

    /* Reset default margins and paddings */
    *,
    *::before,
    *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* Custom font-face declaration */
    @font-face {
      font-family: 'Varela';
      src: url('/fonts/VarelaRound-Regular.ttf');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }

    html {
      font-family: 'Varela', Arial, sans-serif;
      background: var(--color-bg-primary);
      color: var(--color-text-primary);
      font-size: 16px;
      overflow-y: scroll;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: var(--color-bg-primary);
      color: var(--color-text-primary);
      line-height: 1.65;
      transition: background-color 0.3s, color 0.3s;
    }

    footer {
      background-color: var(--color-bg-dark);
      color: var(--color-text-secondary);
      padding: 2rem;
      text-align: center;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      color: var(--color-text-primary);
      margin-bottom: 1rem;
      font-family: 'Varela', 'Open Sans', sans-serif;
      line-height: 1.2;
    }

    h1,
    h2 {
      text-align: center;
    }

    p,
    li {
      color: var(--color-text-primary);
      font-size: 1.05rem;
    }

    h1 {
      font-weight: 700;
      margin-top: 0;
      font-size: 2.2rem;
    }

    h2 {
      font-size: 1.8rem;
    }

    h3 {
      font-size: 1.4rem;
    }

    h4 {
      font-size: 1.2rem;
    }

    h5 {
      font-size: 1.05rem;
    }

    .text-caption {
      font-size: 0.8rem;
    }

    small {
      font-size: 0.85rem;
    }

    button {
      background-color: var(--color-accent);
      color: #ffffff;
      font-size: 1.05rem;
      border: none;
      padding: 10px 20px;
      border-radius: 12px;
      box-shadow: var(--shadow-soft);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    button:hover {
      box-shadow: var(--shadow-hover);
      transform: none;
    }

    button:active {
      box-shadow: var(--shadow-inset);
    }

    .card {
      background-color: var(--color-bg-primary);
      border-radius: 20px;
      box-shadow: var(--shadow-soft);
      padding: 1.5rem;
      transition: box-shadow 0.3s ease;
    }

    .card:hover {
      box-shadow: var(--shadow-hover);
    }

    input,
    select {
      border: none;
      border-radius: 12px;
      padding: 0.75rem 1rem;
      font-size: 1rem;
      width: 100%;
      background-color: var(--color-bg-primary);
      color: var(--color-text-primary);
      box-shadow: var(--shadow-inset);
      transition: all 0.3s ease;
    }

    input:focus,
    select:focus {
      outline: none;
      box-shadow: var(--shadow-inset-active);
    }

    input:focus-visible,
    select:focus-visible,
    button:focus-visible {
      outline: 2px solid var(--color-accent);
      outline-offset: 2px;
    }

    .checkbox-options {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .checkbox-options input[type='checkbox'] {
      appearance: none;
      width: 22px;
      height: 22px;
      border: none;
      border-radius: 6px;
      background-color: var(--color-bg-primary);
      box-shadow: var(--shadow-inset);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .checkbox-options input[type='checkbox']:focus-visible {
      outline: 2px solid var(--color-accent);
      outline-offset: 2px;
    }

    .checkbox-options input[type='checkbox']:checked {
      background-color: var(--color-accent);
      box-shadow: var(--shadow-inset-active);
    }

    .checkbox-options input[type='checkbox']:checked::before {
      content: 'âœ”';
      color: white;
      font-size: 0.85rem;
    }

    .checkbox-options label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--color-text-primary);
      cursor: pointer;
    }

    .dark-mode body {
      background: var(--color-bg-primary);
      color: var(--color-text-primary);
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }
  </style>
</html>
