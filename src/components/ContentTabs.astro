---
import { getLangFromUrl, useTranslations } from '../i18n/utils';
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<div class="content-tabs">
  <div class="tabs-nav" role="tablist">
    <button class="tab-button active" data-tab="memorization" role="tab" aria-selected="true" aria-controls="panel-memorization" id="tab-memorization">
      {t('tab.memorization')}
    </button>
    <button class="tab-button" data-tab="manager" role="tab" aria-selected="false" aria-controls="panel-manager" id="tab-manager">
      {t('tab.manager')}
    </button>
    <button class="tab-button" data-tab="security" role="tab" aria-selected="false" aria-controls="panel-security" id="tab-security">
      {t('tab.security')}
    </button>
  </div>

  <div class="tabs-content">
    <div class="tab-panel active" data-panel="memorization" role="tabpanel" id="panel-memorization" aria-labelledby="tab-memorization">
      <slot name="memorization" />
    </div>
    <div class="tab-panel" data-panel="manager" role="tabpanel" id="panel-manager" aria-labelledby="tab-manager" hidden>
      <slot name="manager" />
    </div>
    <div class="tab-panel" data-panel="security" role="tabpanel" id="panel-security" aria-labelledby="tab-security" hidden>
      <slot name="security" />
    </div>
  </div>
</div>

<style>
  .content-tabs {
    width: 100%;
    max-width: 1024px;
    margin: 0 auto;
  }

  .tabs-nav {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
    padding: 0.5rem;
    background: var(--color-bg-primary);
    border-radius: 16px;
    box-shadow: var(--shadow-soft);
  }

  .tab-button {
    flex: 1;
    padding: 0.75rem 1rem;
    border: none;
    border-radius: 12px;
    background: var(--color-bg-primary);
    color: var(--color-text-secondary);
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    box-shadow: none;
    transition: all 0.3s ease;
  }

  .tab-button:hover {
    color: var(--color-text-primary);
    box-shadow: var(--shadow-soft);
    transform: none;
  }

  .tab-button.active {
    background: var(--color-accent);
    color: #ffffff;
    box-shadow: var(--shadow-inset);
  }

  .tab-button:active {
    box-shadow: var(--shadow-inset);
  }

  .tabs-content {
    background: var(--color-bg-primary);
    border-radius: 20px;
    box-shadow: var(--shadow-soft);
    padding: 2rem;
  }

  .tab-panel {
    display: none;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .tab-panel.active {
    display: block;
    opacity: 1;
  }

  @media (max-width: 768px) {
    .tabs-nav {
      flex-direction: column;
      gap: 0.5rem;
    }

    .tabs-content {
      padding: 1rem;
    }
  }
</style>

<script>
  function initContentTabs() {
    const tabsContainer = document.querySelector('.content-tabs');
    if (!tabsContainer || tabsContainer.dataset.initialized) return;
    tabsContainer.dataset.initialized = 'true';

    const tabButtons = document.querySelectorAll('.tab-button[role="tab"]');
    const tabPanels = document.querySelectorAll('.tab-panel[role="tabpanel"]');

    function activateTab(button) {
      const targetTab = button.getAttribute('data-tab');

      tabButtons.forEach(btn => {
        btn.classList.remove('active');
        btn.setAttribute('aria-selected', 'false');
      });
      tabPanels.forEach(panel => {
        panel.classList.remove('active');
        panel.setAttribute('hidden', '');
      });

      button.classList.add('active');
      button.setAttribute('aria-selected', 'true');
      const targetPanel = document.querySelector(`.tab-panel[data-panel="${targetTab}"]`);
      if (targetPanel) {
        targetPanel.classList.add('active');
        targetPanel.removeAttribute('hidden');
      }
    }

    tabButtons.forEach(button => {
      button.addEventListener('click', () => activateTab(button));
    });

    // Keyboard navigation for tabs
    const tabList = document.querySelector('.tabs-nav[role="tablist"]');
    if (tabList) {
      tabList.addEventListener('keydown', (e) => {
        const tabs = Array.from(tabButtons);
        const currentIndex = tabs.indexOf(document.activeElement);
        let newIndex;

        if (e.key === 'ArrowRight') {
          newIndex = (currentIndex + 1) % tabs.length;
        } else if (e.key === 'ArrowLeft') {
          newIndex = (currentIndex - 1 + tabs.length) % tabs.length;
        } else if (e.key === 'Home') {
          newIndex = 0;
        } else if (e.key === 'End') {
          newIndex = tabs.length - 1;
        } else {
          return;
        }

        e.preventDefault();
        tabs[newIndex].focus();
        activateTab(tabs[newIndex]);
      });
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initContentTabs);
  } else {
    initContentTabs();
  }

  document.addEventListener('astro:page-load', initContentTabs);
  document.addEventListener('astro:after-swap', initContentTabs);
</script>
